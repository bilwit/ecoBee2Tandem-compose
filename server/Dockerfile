# Dockerfile for node backend
FROM node:20-alpine

ARG ECOBEE_APIKEY
ARG ECOBEE_AUTHCODE
ARG ECOBEE_DEVICENAME
ARG TANDEM_ENDPOINT
ARG UPDATEINTERVAL
ARG INIT_REFRESH
ARG TANDEM_INGESTION_PASSWORD

ENV TZ America/Los_Angeles
ENV SHELL /bin/ash
ENV ECOBEE_APIKEY=$ECOBEE_APIKEY
ENV ECOBEE_AUTHCODE=$ECOBEE_AUTHCODE
ENV ECOBEE_DEVICENAME=$ECOBEE_DEVICENAME
ENV TANDEM_ENDPOINT=$TANDEM_ENDPOINT
ENV UPDATEINTERVAL=$UPDATEINTERVAL
ENV INIT_REFRESH=$INIT_REFRESH
ENV TANDEM_INGESTION_PASSWORD=$TANDEM_INGESTION_PASSWORD

WORKDIR /var/www/html/

RUN apk add --no-cache --update tzdata \
  git \
  npm

RUN git clone --depth 1 https://github.com/bilwit/ecoBee2Tandem.git && \
  cd ecoBee2Tandem && \
  npm i 

ENTRYPOINT node server.js;
